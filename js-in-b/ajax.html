<!DOCTYPE html>

<html>

<head>

    <style>
        div > p {
            font-size: 32px;
        }
    </style>

</head>

<body>
AJAX
<div id="display"></div>
<p id="error"></p>
</body>

<script>

// a promise object represents an eventual completion/failure of an operation/function etc

// 1. Cannot return something from a nested function
// 2. The getPuzzle function completes before the readystatechange callback

function getPuzzle(callback) {
    const req = new XMLHttpRequest(); // T = 1
    // T = 2
    req.addEventListener('readystatechange', function (e) {
        if (e.target.readyState == 4 && e.target.status == 200) { // T = 10
            let jso = JSON.parse(e.target.responseText);
            callback(null, jso.puzzle);
        } else if (e.target.readyState == 4) {
            callback('Error', null);
        }
    });
    req.open('GET', 'http://puzzle.mead.io/puzzle?words=4'); // T = 3
    req.send(); // T = 4
}

function puzzleCB(err, puzzle) {
    if (err) {
        document.getElementById('error').innerHTML = 'API error occured.';
    } else {
        document.getElementById('display').innerHTML = puzzle;
    }
};
function f(p) { 
    document.getElementById('display').innerHTML = p;
};
const puzzle = getPuzzle(puzzleCB); // T = 0, T = 6
// f(puzzle);



 // undefined // T = 7

// do something with puzzle
// document.getElementById('display').innerHTML = puzzle;





// const req = new XMLHttpRequest();

// req.addEventListener('readystatechange', (e) => {
//     if (e.target.readyState == 4) {
//         if (e.target.status == 200) {

//             let countries = JSON.parse(e.target.responseText);
//             console.log(countries);
//             // document.getElementById('display').innerHTML = countries[0].flag;
//             countries.forEach((country) => {
//                 const p = document.createElement('p');
//                 p.innerHTML = country.flag;
//                 document.getElementById('display').appendChild(p);
//             });

//         } else {
//             document.getElementById('error').innerHTML = 'API error';
//         }
//     }
// });

// req.open('GET', 'https://restcountries.com/v3.1/all');
// req.send();









// const req = new XMLHttpRequest();
// req.addEventListener('readystatechange', (e) => {
//     if (e.target.readyState == 4 && e.target.status == 200) {
//         let jso = JSON.parse(e.target.responseText);
//         document.getElementById('display').innerHTML = jso.puzzle;
//     } else if (e.target.readyState == 4) {
//         document.getElementById('display').innerHTML = 'API error occured.';
//     }
// });
// req.open('GET', 'http://puzzle.mead.io/puzzle?wordsCount=3');
// req.send();

// req.addEventListener('readystatechange', (event) => {
//     console.log(event);
// });
</script>

</html>
